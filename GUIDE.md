# دليل شامل لموقع مساند التعليمي

هذا الدليل يقدّم نظرة عملية على بنية المنصة وكيفية تشغيلها وصيانتها بعد توحيد المشروع حول تطبيق Express/EJS واحد.

## 🏠 الصفحات والمسارات الرئيسية

| المسار | الوصف | الحماية |
|--------|-------|---------|
| `/` | الصفحة الرئيسية مع نظرة عامة على المنصة | عام |
| `/about` | معلومات حول المنصة والرؤية | عام |
| `/faq` | الأسئلة الشائعة | عام |
| `/course` | استعراض الدورات والمسارات | يتطلب تسجيل الدخول لعرض التقدم |
| `/course/:slug` | تفاصيل الدورة والدروس | محمي |
| `/dashboard` | لوحة التحكم والتقدم | محمي |
| `/certificate` | عرض الشهادات وتنزيل PDF | محمي |
| `/support` | قناة الدعم الفني | عام / بعض النماذج محمية |
| `/settings` | إعدادات الحساب | محمي |
| `/auth/login`, `/auth/register` | صفحات الدخول والتسجيل | عام |

يعتمد الوصول المحمي على جلسات Express المخزّنة في MySQL مع حماية CSRF مفعّلة افتراضيًا.

## 📂 هيكل الملفات الحالي

### الجذر المختصر

```
musanidproject/
├── src/                # كود الخادم الرئيسي
├── public/             # الأصول الجاهزة للخدمة (CSS/JS/Images/PWA)
├── docs/               # نسخة ثابتة للتصفح/التوثيق
├── tests/              # اختبارات Jest
├── package.json
├── tailwind.config.js
└── README.md (و README.en.md)
```

### داخل `src/`

```
src/
├── app.js              # تهيئة Express، الجلسات، الأمن، التوجيه
├── assets/             # مصادر Tailwind وملفات JS غير المجمّعة
├── config/             # إعدادات قواعد البيانات والبيئة
├── middleware/         # (اختياري) وسيطات مخصّصة
├── models/             # نماذج MySQL (Lessons, Progress, Favorite, ...)
├── routes/             # مسارات الويب وواجهات API
├── scripts/            # أدوات مثل check_legacy_redirects
└── views/              # قوالب EJS (layout, صفحات، جزئيات)
```

### داخل `public/`

```
public/
├── css/styles.css      # ناتج Tailwind (يُبنى عبر build:css)
├── js/app.js           # سكربت موحّد للواجهة
├── img/                # الشعارات والأيقونات
├── manifest.json       # إعدادات PWA
├── sw.js               # Service Worker المستخدم فعليًا
└── offline.html        # صفحة عدم الاتصال
```

### داخل `docs/`

- نسخة HTML ثابتة من الواجهة مع أصولها الخاصة (للعرض التسويقي أو الاستضافة كمرجع فقط).
- ملفات إرشادية مكملة مثل `about-musanid.html`, `faq.html`, إضافةً إلى محتوى الشهادات والدورات.

## 🚀 تشغيل المنصة

### تشغيل سريع ( PowerShell أو Bash )

```powershell
Copy-Item .env.example .env
npm install
npm run dev
```

```bash
cp .env.example .env
npm install
npm run dev
```

- الخادم يُشغَّل على افتراضيًا على `http://localhost:3000`.
- أمر `npm run dev` يستخدم Nodemon لإعادة التشغيل التلقائي عند تغيّر الملفات في `src/`.

### أوامر مساندة أثناء التطوير

- `npm run dev:css`: مراقبة ملفات Tailwind في `src/assets/css` وتحديث `public/css/styles.css` فورًا.
- `npm run build:css`: إنتاج نسخة مضغوطة من الأنماط قبل النشر.
- `npm run check:legacy`: التحقق من تحويلات الروابط القديمة لضمان عدم فقدان أي رابط تاريخي.

### تجهيز الإنتاج بسرعة

1. حدّث `.env` ببيانات قاعدة البيانات الفعلية و `SESSION_SECRET` قوي.
2. نفّذ `npm run build:css` لتجهيز الأنماط النهائية.
3. عيّن `NODE_ENV=production`، ثم شغّل `npm start` خلف عاكس يدعم HTTPS.
4. تأكد من إعداد MySQL وتهيئة الجداول عبر `npm run seed:user` (اختياريًا) لإنشاء حساب تجريبي.

## 🔍 استكشاف الأخطاء الشائعة

| المشكلة | الحل السريع |
|---------|-------------|
| الخادم لا يبدأ | تأكد من تثبيت الاعتماديات (`npm install`) ومن صحة إعدادات قاعدة البيانات في `.env`. |
| الخطوط أو الأنماط لا تتحدث | شغّل `npm run dev:css` أثناء التطوير أو `npm run build:css` للبناء اليدوي. |
| ظهور صفحة عدم اتصال رغم توفر الإنترنت | تأكد من تحديث `public/sw.js` (قد تحتاج لمسح الكاش من DevTools > Application > Service Workers). |
| أخطاء 301/404 عند فتح روابط قديمة | استخدم `npm run check:legacy` وتأكد من أن الخادم يعمل على نفس المنفذ الذي يفحصه السكربت. |
| مشاكل في جلسة المستخدم أو CSRF | تحقق من إعدادات الكوكيز في البيئة (خصوصًا عند العمل عبر HTTPS أو خلف Proxy) ومن تزامن الوقت في الخادم. |

## 📝 ملاحظات إضافية

- تم إزالة البنية السابقة (frontend/backend منفصلان) والاكتفاء بتطبيق Express واحد.
- تُعد `docs/` مرجعًا ثابتًا فقط؛ لا يتم تحميلها بواسطة الخادم الرئيسي إلا إذا استُخدمت لأغراض تسويقية.
- تأكد من تشغيل MySQL محليًا أو عبر خدمة مستضافة قبل استخدام ميزات المصادقة والشهادات.
- يمكن تحديث سجلات التقدم والشهادات عبر `docs/js/certificate-manager.js` عند الرغبة في اختبار النسخة الثابتة.
- راجع `IMPROVEMENTS.md` و`UPDATES.md` للاطلاع على سياق التغييرات التاريخية وخطط العمل المستقبلية.