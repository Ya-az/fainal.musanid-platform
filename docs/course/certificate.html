<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙˆØ±Ø© - Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'musanid-dark': '#6D28D9',
                        'musanid-light': '#A78BFA',
                    }
                }
            }
        }
    </script>
    <link href="../css/styles.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(59, 130, 246, 0));
        }

        .certificate-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .certificate-paper {
            position: relative;
            width: min(900px, 100%);
            background: #ffffff;
            padding: 3rem;
            border-radius: var(--radius-xl);
            border: 1px solid rgba(var(--color-primary-rgb), 0.15);
            box-shadow: 0 25px 70px -30px rgba(15, 23, 42, 0.35);
            overflow: hidden;
        }

        .certificate-paper::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(var(--color-primary-rgb), 0.12), transparent 55%),
                        radial-gradient(circle at bottom left, rgba(14, 165, 233, 0.12), transparent 45%);
            opacity: 0.85;
            z-index: 0;
        }

        .certificate-paper > * {
            position: relative;
            z-index: 1;
        }

        .certificate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .certificate-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.85rem;
            border-radius: 999px;
            font-size: 0.85rem;
            background: rgba(var(--color-primary-rgb), 0.1);
            color: var(--color-primary);
        }

        .certificate-name {
            font-size: clamp(2.25rem, 5vw, 3.2rem);
            font-weight: 700;
            letter-spacing: 0.04em;
            margin: 0.5rem 0 1rem;
        }

        .recipient-name {
            color: #000000 !important;
            text-shadow: none !important;
        }

        .certificate-body {
            text-align: center;
            margin-bottom: 2rem;
        }

        .certificate-body *,
        .certificate-footer *,
        .certificate-paper h1,
        .certificate-paper strong {
            color: #000000 !important;
        }

        /* Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        [id="certificateId"],
        [id="certificateDate"], 
        [id="certificateName"],
        [id="certificateNameInline"] {
            color: #000000 !important;
            text-shadow: none !important;
            font-weight: bold !important;
            -webkit-text-fill-color: #000000 !important;
        }

        /* Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ¹Ù„ÙŠ */
        strong:contains("MSN-CISC-MGDLGY1B-IJMI"),
        strong:contains("ÙŠØ²ÙŠØ¯"),
        strong:contains("Yazeed"),
        strong:contains("Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±") {
            color: #000000 !important;
        }

        .certificate-text {
            font-size: 1.1rem;
            line-height: 1.9;
            color: var(--color-neutral-600);
        }

        .certificate-footer {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            align-items: center;
            text-align: center;
        }

        .certificate-footer span {
            display: block;
            font-size: 0.8rem;
            color: var(--color-neutral-500);
            margin-bottom: 0.35rem;
        }

        .certificate-footer strong {
            font-size: 1.1rem;
        }

        /* Ù†ØµÙˆØµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø§Ù„Ø£Ø³ÙˆØ¯ - ØªØ£ÙƒÙŠØ¯ Ø¥Ø¶Ø§ÙÙŠ */
        #certificateId,
        #certificateDate,
        #certificateName,
        #certificateNameInline {
            color: #000000 !important;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯ */
        .certificate-paper #certificateId,
        .certificate-paper #certificateDate,
        .certificate-paper #certificateName,
        .certificate-paper #certificateNameInline,
        .certificate-paper .recipient-name,
        .certificate-footer .value,
        .recipient-name {
            color: #000000 !important;
            text-shadow: none !important;
        }

        /* ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ footer */
        .certificate-footer strong,
        .certificate-footer .value {
            color: #000000 !important;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯ */
        html * #certificateId,
        html * #certificateDate,
        html * #certificateName,
        html * #certificateNameInline,
        body * #certificateId,
        body * #certificateDate,
        body * #certificateName,
        body * #certificateNameInline {
            color: #000000 !important;
            background: transparent !important;
            text-shadow: none !important;
            -webkit-text-fill-color: #000000 !important;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© */
        .certificate-paper,
        .certificate-paper *,
        .certificate-paper h1,
        .certificate-paper strong,
        .certificate-paper .value,
        .certificate-paper .recipient-name,
        .certificate-footer,
        .certificate-footer *,
        .footer-item,
        .footer-item * {
            color: #000000 !important;
            text-shadow: none !important;
            -webkit-text-fill-color: #000000 !important;
        }

        .certificate-signature {
            font-family: 'Tajawal', 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .certificate-watermark {
            position: absolute;
            inset: 1.5rem;
            border: 2px dashed rgba(var(--color-primary-rgb), 0.15);
            border-radius: calc(var(--radius-xl) - 1.5rem);
            pointer-events: none;
        }

        .certificate-notice {
            background: rgba(var(--color-primary-rgb), 0.08);
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .certificate-notice svg {
            flex-shrink: 0;
            color: var(--color-primary);
        }

        @media print {
            /* Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© */
            body * {
                visibility: hidden;
            }

            /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙÙ‚Ø· */
            .certificate-paper,
            .certificate-paper * {
                visibility: visible;
            }

            /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
            body {
                background: #ffffff !important;
                margin: 0;
                padding: 0;
            }

            .certificate-paper {
                position: absolute;
                left: 0;
                top: 0;
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 40px !important;
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                background: #ffffff !important;
                page-break-inside: avoid;
            }

            /* ØªØ­Ø³ÙŠÙ† Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
            .certificate-name {
                font-size: 2.5rem !important;
            }

            .certificate-text {
                font-size: 1rem !important;
                line-height: 1.6 !important;
            }

            .certificate-chip {
                font-size: 0.8rem !important;
            }

            /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
            .certificate-paper::before {
                display: none !important;
            }

            .certificate-watermark {
                border-color: rgba(109, 40, 217, 0.3) !important;
            }

            /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ù„Ø£Ø¨ÙŠØ¶ ÙˆØ§Ù„Ø£Ø³ÙˆØ¯ */
            @media print and (monochrome) {
                .certificate-chip {
                    background: #f0f0f0 !important;
                    color: #333 !important;
                    border: 1px solid #ccc !important;
                }

                .certificate-watermark {
                    border-color: #ccc !important;
                }
            }
        }
    </style>
</head>
<body class="certificate-page">
    <header class="site-header" data-site-header data-base="../" data-active="courses" data-nav-id="certificateNav" data-home="../index.html"></header>

    <main>
        <section class="section">
            <div class="container layout-stack">
                <div class="actions-toolbar flex flex-wrap items-center justify-between gap-sm">
                    <div class="layout-stack layout-stack--xs">
                        <span class="badge badge--success">Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù…</span>
                        <h1 class="heading-xl mb-0">Ù‚ÙØ³ÙŠÙ…Ø© Ø¥Ù†Ø¬Ø§Ø² Ù…ÙˆØ«Ù‚Ø© Ù…Ù† Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯</h1>
                        <p class="text-muted mb-0">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©ØŒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„ØŒ Ø£Ùˆ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ù…Ù„ÙÙƒ ÙÙŠ Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†.</p>
                    </div>
                    <div class="flex flex-wrap gap-sm">
                        <button type="button" class="btn btn-primary" id="printCertificateBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 6,2 18,2 18,9"/>
                                <path d="M6,18H4a2,2,0,0,1-2-2V11a2,2,0,0,1,2-2H20a2,2,0,0,1,2,2v5a2,2,0,0,1-2,2H18"/>
                                <polyline points="6,14 18,14 18,22 6,22 6,14"/>
                            </svg>
                            Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
                        </button>
                        <button type="button" class="btn btn-secondary" id="shareCertificateBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                            Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                    </div>
                </div>

                <div class="certificate-wrapper">
                    <div class="certificate-paper" id="certificatePaper">
                        <span class="certificate-watermark"></span>
                        <div class="certificate-header">
                            <div class="platform-badge">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                    <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                                </svg>
                                Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
                            </div>
                            <div class="field-badge" id="certificateBadge">Ø´Ø¨ÙƒØ§Øª</div>
                        </div>

                        <div class="certificate-body">
                            <p class="subtitle">ØªÙ‚Ø¯ÙŠØ±Ù‹Ø§ Ù„Ù„Ø§Ù„ØªØ²Ø§Ù… ÙˆØ§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯</p>
                            <h1 class="recipient-name" id="certificateName">Yazeed Ahmed Aljuwaybiri</h1>
                            
                            <div class="certificate-text">
                                <p>ØªÙ…Ù†Ø­ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù€ <strong id="certificateNameInline">Yazeed Ahmed Aljuwaybiri</strong> Ù„Ø¥ØªÙ…Ø§Ù…Ù‡ Ø¨Ù†Ø¬Ø§Ø­ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¯ÙˆØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ§Øª <strong id="certificateCourse">Cisco Packet Tracer</strong> Ø¨Ø¥Ø¬Ù…Ø§Ù„ÙŠ <span id="certificateLessons">5</span> Ø¯Ø±ÙˆØ³ ÙˆØ¨Ù…Ø¹Ø¯Ù„ ØªÙ‚Ø¯Ù… <span id="certificateScore">100%</span>.</p>
                                
                                <p>ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¶Ù…Ù† Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØªÙ‚Ù†ÙŠØ§Øª <span id="certificateTrack">Cisco</span> Ø®Ù„Ø§Ù„ Ù…Ø¯Ø© ØªØ¯Ø±ÙŠØ¨ Ù…Ù‚Ø¯Ø§Ø±Ù‡Ø§ <span id="certificateDuration">4 Ø³Ø§Ø¹Ø§Øª</span>.</p>
                            </div>
                        </div>

                        <div class="certificate-footer">
                            <div class="footer-grid">
                                <div class="footer-item">
                                    <span class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</span>
                                    <strong class="value" id="certificateDate">13 Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø± 1447 Ù‡Ù€</strong>
                                </div>
                                <div class="footer-item">
                                    <span class="label">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</span>
                                    <strong class="value" id="certificateId">MSN-CISC-MGDLGY1B-IJMI</strong>
                                </div>
                                <div class="footer-item">
                                    <span class="label">ÙØ±ÙŠÙ‚ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯</span>
                                    <span class="value">Ù…Ø±ÙƒØ² Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="certificate-notice print-visible">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                        <path d="M12 9v4" stroke-linecap="round"/>
                        <path d="M12 17h.01" stroke-linecap="round"/>
                        <path d="m21 12-9 9-9-9 9-9 9 9z" stroke-linejoin="round"/>
                    </svg>
                    <div class="layout-stack layout-stack--xs">
                        <strong>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</strong>
                        <p class="text-sm text-muted mb-0">ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¹Ø¨Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…Ù‡Ø§ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
                    </div>
                </div>

                <div class="card layout-stack print-visible">
                    <h2 class="heading-md mb-0">Ø®Ø·ÙˆØ§Øª Ù…Ù‚ØªØ±Ø­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</h2>
                    <ul class="list-disc pr-lg text-body layout-stack layout-stack--xs">
                        <li>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ù…Ù„ÙÙƒ Ø¹Ù„Ù‰ Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù† Ø£Ùˆ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©.</li>
                        <li>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù…Ø¹ ÙØ±ÙŠÙ‚Ùƒ Ø£Ùˆ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„ØªÙ„Ù‡Ù…Ù‡Ù… Ø¨Ø®Ø·ÙˆØªÙƒ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.</li>
                        <li>Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø®Ø¨Ø±Ø©.</li>
                    </ul>
                    <div class="flex flex-wrap gap-sm">
                        <a class="btn btn-ghost" id="backToCourseBtn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø©</a>
                        <a class="btn btn-secondary" href="cr_index.html">Ø§ÙƒØªØ´Ø§Ù Ø¯ÙˆØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</a>
                    </div>
                </div>

                <div class="card layout-stack" id="certificateArchiveCard">
                    <div class="flex flex-wrap items-start justify-between gap-sm">
                        <div class="layout-stack layout-stack--xs">
                            <h2 class="heading-md mb-0">Ø³Ø¬Ù„ Ø´Ù‡Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
                            <p class="text-sm text-muted mb-0">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø£ÙŠ Ø´Ù‡Ø§Ø¯Ø© ØµØ¯Ø±Øª Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø²ÙŠÙ„Ù‡Ø§ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
                        </div>
                        <button type="button" class="btn btn-ghost btn--sm" id="refreshCertificatesBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23,4 23,10 17,10"/>
                                <polyline points="1,20 1,14 7,14"/>
                                <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"/>
                            </svg>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                    <div class="layout-stack layout-stack--sm" id="certificateArchiveList" role="list"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer" data-site-footer data-base="../"></footer>

    <script src="../js/config.js"></script>
    <script src="../js/course-manager.js"></script>
    <script src="../js/certificate-manager.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" integrity="sha384-WfXMXirMRHkRkNvztNFVQVw1Gc7YCOUMIqFZRMVAb9YSEuxsjjXNMTvEfgQ6Vw5j" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" integrity="sha384-nNrihYUxE6xBPdZiZsaAJ+lZeI7IuAvV38DSHLVbkP4SRrped1IovnHgwlHGawEq" crossorigin="anonymous"></script>
    <script src="../js/config.js"></script>
    <script src="../js/components/header.js"></script>
    <script src="../js/components/footer.js"></script>
    <script>
        // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù†ØµÙˆØµ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯
        document.addEventListener('DOMContentLoaded', function() {
            const blackTextElements = [
                '#certificateId',
                '#certificateDate', 
                '#certificateName',
                '#certificateNameInline',
                '.recipient-name',
                '.footer-item strong',
                '.footer-item .value'
            ];
            
            blackTextElements.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element) {
                        element.style.color = '#000000';
                        element.style.textShadow = 'none';
                        element.style.webkitTextFillColor = '#000000';
                        element.style.setProperty('color', '#000000', 'important');
                    }
                });
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
            const certificatePaper = document.querySelector('.certificate-paper');
            if (certificatePaper) {
                const allElements = certificatePaper.querySelectorAll('*');
                allElements.forEach(element => {
                    const computedStyle = window.getComputedStyle(element);
                    if (computedStyle.color === 'rgb(255, 255, 255)' || computedStyle.color === 'white') {
                        element.style.setProperty('color', '#000000', 'important');
                    }
                });
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const courseId = params.get('course');
            const certificateParamId = params.get('certificateId');
            const nameParam = params.get('name');

            const course = courseId ? courseManager.getCourse(courseId) : null;
            let certificateData = null;

            if (typeof certificateManager !== 'undefined') {
                if (courseId) {
                    certificateData = certificateManager.getCertificate(courseId) || null;
                }

                if (!certificateData && certificateParamId) {
                    certificateData = certificateManager.getCertificateById(certificateParamId);
                }
            }

            const profile = typeof certificateManager !== 'undefined' ? certificateManager.getProfile() : null;
            const fallbackName = nameParam || profile?.fullName || 'Ø£Ø­Ø¯ Ù…ØªØ¹Ù„Ù…ÙŠ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';

            if (!certificateData && courseId && course) {
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§ØµØ© Ù„Ø´Ù‡Ø§Ø¯Ø© Ø³ÙŠØ³ÙƒÙˆ
                if (courseId === 'cisco-ccna') {
                    certificateData = {
                        courseId,
                        courseTitle: 'Cisco Packet Tracer',
                        courseBadge: 'Ø´Ø¨ÙƒØ§Øª',
                        userName: fallbackName,
                        certificateId: 'MSN-CISC-MGDLGY1B-IJMI',
                        issuedAt: '2024-10-13T00:00:00.000Z',
                        totalLessons: 5,
                        lessonsCompleted: 5,
                        score: 100,
                        duration: '4 Ø³Ø§Ø¹Ø§Øª',
                        track: 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØªÙ‚Ù†ÙŠØ§Øª Cisco',
                        metadata: { isExample: true }
                    };
                } else {
                    certificateData = {
                        courseId,
                        courseTitle: course.title,
                        courseBadge: course.badge,
                        userName: fallbackName,
                        certificateId: `MSN-TEMP-${Date.now().toString(36).toUpperCase()}`,
                        issuedAt: new Date().toISOString(),
                        totalLessons: course.lessons?.length || null,
                        lessonsCompleted: course.lessons?.length || null,
                        score: 100,
                        metadata: { generatedOnFly: true }
                    };
                }
            }

            const courseTitle = certificateData?.courseTitle || course?.title || 'Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';
            const courseBadge = certificateData?.courseBadge || course?.badge || 'Ù…Ø³Ø§Ø± ØªØ¯Ø±ÙŠØ¨ÙŠ';
            const userName = certificateData?.userName || fallbackName;
            const totalLessons = certificateData?.totalLessons || course?.lessons?.length || null;
            const progressScore = certificateData?.score ?? 100;
            const issuedAt = certificateData?.issuedAt || new Date().toISOString();

            document.getElementById('certificateCourse').textContent = courseTitle;
            document.getElementById('certificateBadge').textContent = courseBadge;
            document.getElementById('certificateName').textContent = userName;
            document.getElementById('certificateNameInline').textContent = userName;
            document.getElementById('certificateDate').textContent = formatCertificateDate(issuedAt);
            document.getElementById('certificateId').textContent = certificateData?.certificateId || 'â€”';
            document.getElementById('certificateTrack').textContent = certificateData?.track || resolveTrackName(course?.category);
            document.getElementById('certificateScore').textContent = `${progressScore}%`;
            document.getElementById('certificateLessons').textContent = totalLessons ? `${totalLessons}` : 'â€”';
            document.getElementById('certificateDuration').textContent = certificateData?.duration || course?.duration || 'â€”';

            const backToCourseBtn = document.getElementById('backToCourseBtn');
            if (backToCourseBtn && courseId) {
                backToCourseBtn.href = `course-detail.html?course=${courseId}`;
            }

            const archiveCard = document.getElementById('certificateArchiveCard');
            const archiveList = document.getElementById('certificateArchiveList');
            const refreshArchiveBtn = document.getElementById('refreshCertificatesBtn');

            const printBtn = document.getElementById('printCertificateBtn');
            printBtn?.addEventListener('click', () => {
                window.print();
            });

            const shareBtn = document.getElementById('shareCertificateBtn');
            shareBtn?.addEventListener('click', async () => {
                try {
                    const currentUrl = window.location.href;
                    await navigator.clipboard.writeText(currentUrl);
                    
                    // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
                    const originalText = shareBtn.innerHTML;
                    shareBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
                    shareBtn.disabled = true;
                    
                    setTimeout(() => {
                        shareBtn.innerHTML = originalText;
                        shareBtn.disabled = false;
                    }, 2000);
                    
                } catch (error) {
                    // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù†Ø³Ø®
                    const textArea = document.createElement('textarea');
                    textArea.value = window.location.href;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©!');
                }
            });

            refreshArchiveBtn?.addEventListener('click', () => {
                try {
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª
                    renderCertificateArchive(archiveCard, archiveList, certificateData?.certificateId || null);
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    const originalText = refreshArchiveBtn.innerHTML;
                    refreshArchiveBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!';
                    refreshArchiveBtn.disabled = true;
                    
                    setTimeout(() => {
                        refreshArchiveBtn.innerHTML = originalText;
                        refreshArchiveBtn.disabled = false;
                    }, 1500);
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø´ÙŠÙ:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø´ÙŠÙ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
            });

            renderCertificateArchive(archiveCard, archiveList, certificateData?.certificateId || null);
        });

        function formatCertificateDate(value) {
            if (!value) {
                return 'â€”';
            }
            
            // Ù„Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©ØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
            if (value === '2024-10-13T00:00:00.000Z') {
                return '13 Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø± 1447 Ù‡Ù€';
            }
            
            const date = new Date(value);
            if (Number.isNaN(date.getTime())) {
                return 'â€”';
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ø¯ÙŠ Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø®Ø±Ù‰
            return date.toLocaleDateString('ar-SA', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        function resolveTrackName(category) {
            switch (category) {
                case 'networking':
                    return 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØªÙ‚Ù†ÙŠØ§Øª Cisco';
                case 'security':
                    return 'Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                case 'programming':
                    return 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆJava';
                case 'systems':
                    return 'Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±ØªÙ‡Ø§';
                default:
                    return 'Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ø¯Ù‰ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';
            }
        }

        function buildShareQuery(courseId, certificateData) {
            const params = new URLSearchParams();
            if (courseId) {
                params.set('course', courseId);
            }
            if (certificateData?.certificateId) {
                params.set('certificateId', certificateData.certificateId);
            }
            if (!certificateData || certificateData.metadata?.generatedOnFly) {
                params.set('name', certificateData?.userName || '');
            }
            return params.toString();
        }

        function copyToClipboardFallback(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.setAttribute('readonly', '');
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        function notify(message, type) {
            if (typeof showMessage === 'function') {
                showMessage(message, type === 'error' ? 'error' : type === 'success' ? 'success' : 'info');
            } else {
                alert(message);
            }
        }

        function renderCertificateArchive(archiveCard, archiveList, currentCertificateId = null) {
            if (!archiveCard || !archiveList) {
                return;
            }

            if (typeof certificateManager === 'undefined') {
                archiveCard.classList.add('is-hidden');
                archiveList.innerHTML = '';
                return;
            }

            archiveCard.classList.remove('is-hidden');

            const hasGetAll = typeof certificateManager.getAllCertificates === 'function';
            let certificates = hasGetAll
                ? certificateManager.getAllCertificates({ sort: 'desc' })
                : Object.values(certificateManager.certificates || {});

            if (!hasGetAll) {
                certificates = certificates.sort((a, b) => {
                    const timeA = a?.issuedAt ? Date.parse(a.issuedAt) || 0 : 0;
                    const timeB = b?.issuedAt ? Date.parse(b.issuedAt) || 0 : 0;
                    return timeB - timeA;
                });
            }

            archiveList.innerHTML = '';

            if (!certificates.length) {
                const emptyState = document.createElement('div');
                emptyState.className = 'text-sm text-muted';
                emptyState.textContent = 'Ù„Ù… ØªØµØ¯Ø± Ø£ÙŠ Ø´Ù‡Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯. Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù‡Ù†Ø§ ÙÙˆØ± Ø¥ØµØ¯Ø§Ø±Ù‡Ø§.';
                archiveList.appendChild(emptyState);
                return;
            }

            certificates.forEach(certificate => {
                const item = document.createElement('div');
                item.className = 'card card--muted layout-stack';
                item.setAttribute('role', 'listitem');

                const header = document.createElement('div');
                header.className = 'flex flex-wrap items-start justify-between gap-sm';

                const infoStack = document.createElement('div');
                infoStack.className = 'layout-stack layout-stack--xs';

                const titleEl = document.createElement('div');
                titleEl.className = 'heading-sm mb-0';
                titleEl.textContent = certificate.courseTitle || 'Ø¯ÙˆØ±Ø© Ù…Ù† Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';

                const metaEl = document.createElement('p');
                metaEl.className = 'text-sm text-muted mb-0';
                const dateLabel = formatCertificateDate(certificate.issuedAt);
                const idLabel = certificate.certificateId || 'â€”';
                metaEl.textContent = `ØµØ¯Ø± Ø¨ØªØ§Ø±ÙŠØ® ${dateLabel} â€¢ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ${idLabel}`;

                infoStack.append(titleEl, metaEl);

                if (currentCertificateId && certificate.certificateId === currentCertificateId) {
                    const badge = document.createElement('span');
                    badge.className = 'badge badge--success align-start';
                    badge.textContent = 'Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
                    infoStack.appendChild(badge);
                }

                const actionsWrap = document.createElement('div');
                actionsWrap.className = 'flex flex-wrap gap-sm';

                const viewBtn = document.createElement('button');
                viewBtn.type = 'button';
                viewBtn.className = 'btn btn-secondary';
                viewBtn.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©';
                viewBtn.addEventListener('click', () => {
                    openCertificatePage(certificate);
                });

                const shareBtn = document.createElement('button');
                shareBtn.type = 'button';
                shareBtn.className = 'btn btn-ghost';
                shareBtn.textContent = 'Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·';
                shareBtn.addEventListener('click', () => {
                    shareCertificateLink(certificate, {
                        courseTitle: certificate.courseTitle,
                        userName: certificate.userName
                    });
                });

                actionsWrap.append(viewBtn, shareBtn);
                header.append(infoStack, actionsWrap);
                item.append(header);

                archiveList.append(item);
            });
        }

        function openCertificatePage(certificate) {
            if (!certificate) {
                notify('ØªØ¹Ø°Ø± ÙØªØ­ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.', 'error');
                return;
            }

            const query = buildShareQuery(certificate.courseId, certificate);
            const targetUrl = query ? `${window.location.pathname}?${query}` : window.location.pathname;
            window.open(targetUrl, '_blank', 'noopener');
        }

        async function shareCertificateLink(certificate, context = {}) {
            if (!certificate) {
                notify('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø§Ø¯Ø© Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§.', 'error');
                return;
            }

            const origin = (window.location.origin && window.location.origin !== 'null') ? window.location.origin : '';
            const shareUrl = `${origin}${window.location.pathname}?${buildShareQuery(certificate.courseId, certificate)}`;
            const courseTitle = context.courseTitle || certificate.courseTitle || 'Ø´Ù‡Ø§Ø¯Ø© Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';
            const userName = context.userName || certificate.userName || 'Ø£Ø­Ø¯ Ù…ØªØ¹Ù„Ù…ÙŠ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯';

            try {
                if (navigator.share) {
                    await navigator.share({
                        title: `Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… - ${courseTitle}`,
                        text: `${userName} Ø£ÙƒÙ…Ù„ Ø¯ÙˆØ±Ø© ${courseTitle} Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Ù…Ø³Ø§Ù†Ø¯.`,
                        url: shareUrl
                    });
                    notify('ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.', 'success');
                } else if (navigator.clipboard) {
                    await navigator.clipboard.writeText(shareUrl);
                    notify('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.', 'success');
                } else {
                    copyToClipboardFallback(shareUrl);
                    notify('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.', 'info');
                }
            } catch (error) {
                notify('ØªØ¹Ø°Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·. Ø¬Ø±Ù‘Ø¨ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§.', 'error');
            }
        }

        async function downloadCertificateAsPdf(triggerBtn) {
            const certificateElement = document.getElementById('certificatePaper');
            if (!certificateElement) {
                throw new Error('certificate element not found');
            }

            const hasLibraries = Boolean(window.html2canvas) && Boolean(window.jspdf?.jsPDF);
            if (!hasLibraries) {
                window.print();
                return;
            }

            const originalText = triggerBtn?.textContent;
            if (triggerBtn) {
                triggerBtn.disabled = true;
                triggerBtn.textContent = 'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF...';
            }

            try {
                const canvas = await window.html2canvas(certificateElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                });

                const imgData = canvas.toDataURL('image/png', 1.0);
                const pdf = new window.jspdf.jsPDF('landscape', 'pt', [canvas.width * 0.75, canvas.height * 0.75]);
                pdf.addImage(imgData, 'PNG', 0, 0, canvas.width * 0.75, canvas.height * 0.75);

                const learnerName = (document.getElementById('certificateName')?.textContent || 'learner')
                    .replace(/[\\/:*?"<>|]+/g, '-')
                    .trim() || 'learner';

                pdf.save(`Musanid-Certificate-${learnerName}.pdf`);

                notify('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨ØµÙŠØºØ© PDF Ø¨Ù†Ø¬Ø§Ø­.', 'success');
            } catch (error) {
                console.error('Failed to generate certificate PDF:', error);
                notify('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDFØŒ Ø³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙƒØ¨Ø¯ÙŠÙ„.', 'error');
                window.print();
            } finally {
                if (triggerBtn) {
                    triggerBtn.disabled = false;
                    triggerBtn.textContent = originalText || 'ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù PDF';
                }
            }
        }
    </script>
</body>
</html>
